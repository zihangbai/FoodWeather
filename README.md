# FoodWeather
# 食品天气项目 - 数据挖掘与客户分析系统

## 项目概述

本项目旨在通过数据分析和挖掘技术，探索天气条件与食品消费行为之间的关联，并基于客户消费数据进行客户分层和菜品关联规则分析，为餐饮企业提供精准营销和个性化推荐策略。

## 项目结构

```
食品天气项目/
├── cleaned_dataset/           # 清洗后的数据文件
│   ├── cleaned_customer.xlsx  # 清洗后的客户数据
│   ├── cleaned_orders.xlsx    # 清洗后的订单数据
│   ├── cleaned_product.xlsx   # 清洗后的产品数据
│   └── cleaned_weather.xlsx   # 清洗后的天气数据
├── feature_engineered_dataset/ # 特征工程处理后的数据
│   ├── customer_features.xlsx      # 客户特征数据
│   ├── order_product_features.xlsx # 订单产品特征数据
│   ├── weather_features.xlsx       # 天气特征数据
│   └── standardized_core_features.xlsx # 标准化核心特征
├── 优化后客户分层结果/        # K-means聚类分析结果
├── 客户分层结果/              # 原始客户分层结果
├── 聚类对比结果/              # 不同聚类方法对比结果
├── 菜品关联规则结果/          # 原始关联规则分析结果
├── 菜品关联规则_优化版结果/    # 优化后的关联规则分析结果
├── 论文/                      # 相关论文文件
├── 数据清洗.py                # 数据清洗脚本
├── 特征工程.py                # 特征工程脚本
├── Apriori 菜品关联规则.py     # 原始菜品关联规则分析脚本
├── 优化后的关联规则.py         # 优化版关联规则分析脚本
├── apriori_pytorch.py         # PyTorch加速的关联规则分析脚本
├── pytorch优化K-means聚类.py   # PyTorch优化的K-means聚类脚本
├── feature_compare_standard.png # 各客户类型核心特征对比图
├── high_value_rule_graph_basic.png # 高价值客户菜品关联规则图
├── normal_value_rule_graph_basic.png # 一般客户菜品关联规则图
├── pytorch_kmeans_elbow.png   # K-means肘部法则图
└── 客户聚类TSNE可视化.png      # 客户聚类TSNE降维图
```

## 核心功能

### 1. 数据清洗模块

**文件**: `数据清洗.py`

**主要功能**:
- 从多个数据源加载客户、订单、产品和天气数据
- 数据类型转换和缺失值处理
- 数据抽样以控制数据量（≤100万行，符合Excel限制）
- 日期标准化处理
- 菜品分类映射（英文转中文）
- 生成清洗后的数据集

**关键技术**:
- 分层抽样技术保证数据覆盖性
- 异常值检测与标记
- 多数据源合并与去重

### 2. 特征工程模块

**文件**: `特征工程.py`

**主要功能**:
- 客户特征构建：性别编码、菜系偏好独热编码、动态分箱等
- 订单产品特征构建：菜品购买频次、订单内品类占比等
- 天气特征构建：温度分箱、天气类型编码等
- 多源特征合并
- 特征选择与标准化

**关键技术**:
- 动态分箱技术（根据数据分布自动调整分箱数量）
- LabelEncoder和One-Hot编码
- 特征选择（方差筛选）
- 特征标准化

### 3. 客户聚类分析

**文件**: `pytorch优化K-means聚类.py`

**主要功能**:
- PyTorch加速的K-means聚类算法
- 自动选择最优K值（肘部法则+轮廓系数）
- 聚类结果可视化（t-SNE降维）
- 各客户类型核心特征对比图生成
- 客户分层与特征分析

**关键技术**:
- PyTorch张量运算加速
- 肘部法则和轮廓系数确定最优簇数
- t-SNE降维可视化
- 客户价值评分体系

### 4. 菜品关联规则分析

**文件**: `优化后的关联规则.py`、`apriori_pytorch.py`

**主要功能**:
- 构建交易集数据结构
- Apriori算法挖掘频繁项集和关联规则
- 分客户类型（高价值/一般客户）分析
- 关联规则可视化（网络图、柱状图）
- 推荐策略生成

**优化版本改进**:
- 支持品类/菜品名切换
- 可调整的阈值参数
- 更完善的可视化图表
- 更详细的推荐策略

**PyTorch版本优势**:
- GPU加速计算
- 高效的张量运算
- 可处理更大规模数据

## 技术栈

- **编程语言**: Python 3.7+
- **核心库**:
  - Pandas: 数据处理与分析
  - NumPy: 数值计算
  - Matplotlib/Seaborn: 数据可视化
  - Scikit-learn: 机器学习算法
  - PyTorch: 深度学习框架（用于加速计算）
  - NetworkX: 网络分析与可视化
  - mlxtend: 关联规则挖掘算法

## 运行指南

### 1. 环境配置

```bash
# 安装依赖
pip install pandas numpy matplotlib seaborn scikit-learn torch networkx mlxtend openpyxl
```

### 2. 运行顺序

```
1. 数据清洗.py → 2. 特征工程.py → 3. pytorch优化K-means聚类.py → 4. 优化后的关联规则.py
```

### 3. 详细运行步骤

#### 步骤1: 数据清洗
```bash
python 数据清洗.py
```
- 输出: `cleaned_dataset/`目录下的清洗后数据文件

#### 步骤2: 特征工程
```bash
python 特征工程.py
```
- 输出: `feature_engineered_dataset/`目录下的特征工程后数据文件

#### 步骤3: 客户聚类分析
```bash
python pytorch优化K-means聚类.py
```
- 输出:
  - 客户分层结果文件
  - `feature_compare_standard.png`: 各客户类型核心特征对比图
  - `客户聚类TSNE可视化.png`: 客户聚类降维可视化图
  - `pytorch_kmeans_elbow.png`: 肘部法则图

#### 步骤4: 菜品关联规则分析
```bash
python 优化后的关联规则.py
# 或使用PyTorch加速版本
python apriori_pytorch.py
```
- 输出:
  - `high_value_rule_graph_basic.png`: 高价值客户菜品关联规则图
  - `normal_value_rule_graph_basic.png`: 一般客户菜品关联规则图
  - `菜品关联规则_优化版结果/`目录下的关联规则分析结果

## 主要参数配置

### 数据清洗参数
- `sample_ratio`: 天气数据抽样比例（默认0.15）
- `max_rows`: 最大数据行数限制（100万）

### 特征工程参数
- `max_bins`: 动态分箱最大数量（默认3）

### 关联规则参数
- `MIN_SUPPORT`: 最小支持度（默认0.02）
- `MIN_CONFIDENCE`: 最小置信度（默认0.2）
- `MIN_LIFT`: 最小提升度（默认1.1）
- `USE_PRODUCT_NAME`: 是否使用产品名称（False=使用品类，True=使用具体菜品名）

### 聚类分析参数
- `max_k`: 最大簇数（默认6）
- `threshold`: 方差筛选阈值（默认0.05）

## 结果解读

### 1. 客户分层结果

| 客户类型 | 特征描述 | 比例 |
|---------|---------|------|
| 普通客户 | 消费金额低、频率低 | ~50% |
| 高消费客户 | 消费金额高但频率适中 | ~27% |
| 高价值客户 | 消费金额高、频率高、满意度高 | ~23% |

### 2. 关联规则结果

**示例输出**:
```
📊 高价值客户关联规则结果：
前项 → 后项 | 支持度 | 置信度 | 提升度
100% Whole Wheat Bread → Orange Bell Pepper | 0.02 | 1.00 | 5.00
Premium Salmon Fillet → Baby Spinach | 0.02 | 1.00 | 4.50

📊 一般客户关联规则结果：
前项 → 后项 | 支持度 | 置信度 | 提升度
Globe Eggplant → Broccoli & Cheddar Bake Meal Bowl | 0.02 | 1.00 | 6.00
Organic Baby Carrots → Hearty Vegetable Soup | 0.02 | 1.00 | 5.50
```

### 3. 推荐策略

**高价值客户推荐策略**:
- VIP菜单设置「专属搭配套餐」
- 高端套餐搭配服务升级
- 定制化推荐（基于个人偏好）

**一般客户推荐策略**:
- APP首页设置「热门组合」入口
- 会员日组合折扣
- 高性价比套餐推荐

**高消费客户推荐策略**:
- 提供高端产品组合套餐
- 定期推送新品信息
- 邀请参加产品品鉴会

## 扩展与改进

### 1. 现有系统优化方向

- 增加更多数据源（如社交媒体数据、供应链数据）
- 实现实时数据分析与推荐
- 引入深度学习模型（如CNN、RNN）改进预测精度
- 开发可视化界面（如Streamlit或Flask应用）

### 2. 可能的扩展功能

- 天气影响分析（量化天气对消费的影响程度）
- 销售预测模型
- 客户流失预警系统
- 动态定价策略

## 论文与文档

项目包含相关论文文件，位于`论文/`目录下，涵盖：
- 数据挖掘方法介绍
- 实验结果分析
- 商业应用建议

## 注意事项

1. **数据路径**：请确保所有脚本中的数据路径正确配置
2. **内存需求**：处理大规模数据时建议使用至少8GB内存
3. **GPU支持**：PyTorch版本支持GPU加速，可显著提高计算效率
4. **参数调整**：根据实际数据规模和业务需求调整相关参数
5. **结果验证**：建议对输出结果进行业务验证，确保符合实际情况

## 联系方式

如有问题或建议，请联系项目团队。

---

**版本**: 1.1.0
**更新日期**: 2025-12-19
**项目状态**: 已完成核心功能开发和优化
